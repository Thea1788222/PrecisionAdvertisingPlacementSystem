# 匿名用户精准广告投放生态系统

## 项目概述

本项目实现一个完整的广告投放生态系统，包含4个独立网站：

- **广告管理平台**：管理广告商、广告素材、投放策略、数据分析
- **购物网站**：电商平台，展示商品并投放广告
- **视频网站**：视频分享平台，支持视频中插广告
- **新闻网站**：新闻资讯平台，投放原生广告

核心特性：无需用户登录，通过Cookie和浏览器指纹实现跨站精准广告投放

------

## 一、前期准备

### 1.1 成员分工
- 杨宇程：广告管理网站及广告投放服务
- 刘泽佳：视频发布分享网站建设
- 郭思甜：购物网站建设
- 石珈铭：新闻网站建设

### 1.2 开发环境要求

#### 必需软件

| 软件    | 版本 | 用途     |
| ------- | ---- | -------- |
| JDK     | 17+  | 后端开发 |
| Maven   | 3.8+ | 项目构建 |
| MySQL   | 8.0+ | 数据存储 |
| Node.js | 16+  | 前端工具 |
| Git     | 2.0+ | 版本控制 |

#### 开发IDE

- IntelliJ IDEA Ultimate（后端开发）
- VS Code（前端开发）

#### 浏览器

- Chrome（主要测试浏览器，支持开发者工具）
- Firefox（跨浏览器测试）


### 1.3 数据准备

#### 测试数据

- **广告素材**：准备20-30张横幅广告图片（尺寸：728x90, 300x250）
- **视频广告**：准备5-10个视频广告（时长15-30秒，格式：MP4）
- **商品数据**：准备50个商品信息（图片、名称、价格、类别）
- **视频内容**：准备10个视频文件（测试用）
- **新闻文章**：准备30篇新闻（标题、摘要、正文）

#### 数据分类

建议的广告类别：

- 电子产品（electronics）
- 服装鞋帽（fashion）
- 食品饮料（food）
- 运动户外（sports）
- 家居生活（home）
- 图书教育（education）

------

## 二、基本设计思路

### 2.1 系统架构
![广告投放.png](photo/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE.png)

### 2.2 核心设计理念

#### 匿名追踪机制

1. **第一层识别：Cookie**

   当使用不同物理服务器部署时：
   - 由于同源策略限制，无法直接跨域设置Cookie
   - 采用iframe嵌入方式实现Cookie共享
   - 在广告追踪服务中提供专门的cookie管理页面
   - 通过postMessage API实现跨域通信

2. **第二层识别：浏览器指纹**

   - Canvas指纹（核心）
   - UserAgent
   - 屏幕分辨率
   - 时区和语言
   - 安装的字体列表
   - WebGL指纹

3. **双重绑定策略**

   ```
   用户ID = Cookie ID (主) + Browser Fingerprint (辅)
   ```

   - Cookie被清除时，通过指纹找回历史数据
   - 指纹碰撞时，通过Cookie区分不同用户
   - 在不同物理服务器部署模式下，主要依赖浏览器指纹识别

#### 精准投放算法

**阶段一：冷启动（新用户）**

```
广告分数 = 出价 × 随机因子
```

- 随机展示不同类别广告
- 探索用户兴趣

**阶段二：兴趣探索（有少量行为数据）**

```
广告分数 = 出价 × (1 + 类别匹配度 × 0.5)
```

- 根据浏览、搜索行为推测兴趣
- 增加相关类别广告曝光

**阶段三：精准投放（有充分数据）**

```
广告分数 = 出价 × (1 + 兴趣权重 + 时间衰减)

兴趣权重 = Σ(行为权重 × 类别相关度)
行为权重：浏览(0.1) < 搜索(0.3) < 点击(0.5) < 购买(1.0)
时间衰减：recent_score = score × e^(-λt)，λ=0.1
```

#### 视频中插广告策略

**插入时机**

```
短视频（<3分钟）：不插入
中等视频（3-10分钟）：在 1/3 处插入1个广告
长视频（>10分钟）：每5分钟插入1个广告
```

**广告选择**

1. 优先选择视频类广告
2. 时长：15-30秒
3. 5秒后允许跳过
4. 广告结束后自动恢复播放


------

## 三、技术选型

### 3.1 后端技术栈

| 技术              | 版本     | 用途     | 选型理由       |
| --------------- | ------ | ------ | ---------- |
| Spring Boot     | 3.1.x  | Web框架  | 快速开发、生态完善  |
| Spring Data JPA | 3.1.x  | ORM框架  | 简化数据库操作    |
| MySQL           | 8.0    | 关系数据库  | 成熟稳定、支持事务  |
| Lombok          | 1.18.x | 代码简化   | 减少样板代码     |
| Jackson         | 2.15.x | JSON处理 | Spring默认集成 |


### 3.2 前端技术栈

| 技术        | 版本    | 用途        | 选型理由              |
|-----------| ------- | ----------- | --------------------- |
| Vue       | 3.x     | 前端框架    | 渐进式框架，易于上手和集成  |
| Vue Router| 4.x     | 路由管理    | 官方路由解决方案        |
| Pinia     | 2.x     | 状态管理    | Vue官方推荐的轻量级状态管理 |
| Vite      | 4.x     | 构建工具    | 快速的构建和热重载       |



### 3.3 部署技术栈

| 技术      | 版本    | 用途              |
| ------- | ----- | --------------- |
| Nginx   | 1.24+ | 反向代理、负载均衡     |


### 3.4 开发工具

| 工具              | 用途        |
| --------------- | --------- |
| Postman         | API测试     |
| Chrome DevTools | 前端调试    |
| Git             | 版本控制    |
| Maven           | 项目构建    |
| Node.js         | 前端构建工具 |


------

## 四、开发进度安排

### 总体时间规划：4周

------

### 第一周：基础设施搭建（Week 1）

#### Day 1-2：环境准备与数据库设计

- [x] 搭建开发环境（JDK、Maven、MySQL、IDE）
- [x] 创建数据库，执行建表SQL脚本
- [ ] 准备测试数据（广告素材、商品、视频、新闻）

**交付物**：

- 数据库Schema完成
- 测试数据导入完成
- README文档

#### Day 3-4：项目框架搭建

- [x] 创建后端服务项目结构
  - 使用Maven创建5个Spring Boot项目
  - 配置pom.xml依赖（Spring Boot、Spring Data JPA、MySQL Connector等）
  - 配置application.yml（数据库连接、端口等）
  - 创建基础包结构（controller、service、repository、model）
- [x] 创建前端项目结构
  - 使用Vue CLI创建4个Vue 3项目
  - 配置路由和状态管理（Vue Router、Pinia）
  - 配置代码检查和格式化工具（ESLint、Prettier）
  - 集成UI组件库（Element Plus）
- [x] 数据库连接测试
  - 验证各服务能正常连接MySQL数据库
- [x] 建立服务间通信机制
  - 配置RESTful API接口
  - 实现服务间数据传输格式定义



**交付物**：

- 5个项目骨架完成
- 数据库连接测试通过
- API文档

#### Day 5-7：广告追踪服务核心开发（杨）

- [ ] 实现用户行为追踪API
  - POST /track/behavior（记录行为）
  - POST /track/impression（记录展示）
  - POST /track/click（记录点击）
- [ ] 实现浏览器指纹生成
- [ ] 实现Cookie管理（支持不同物理服务器模式）
- [ ] 实现用户画像构建逻辑
- [ ] 实现广告推荐算法
- [ ] 开发追踪SDK（ad-tracker.js）

**交付物**：

- 追踪服务API完成
- ad-tracker.js SDK可用
- 用户行为可正常记录


------

### 第二周：业务网站开发（Week 2）

#### Day 8-10：购物网站开发（郭）

**前端页面开发**
- [ ] 首页布局设计
  - 顶部导航栏（含搜索框）
  - 轮播图/Banner区域
  - 商品分类导航
  - 商品推荐列表
  - 底部信息
- [ ] 商品列表页
  - 分类筛选
  - 排序功能
  - 分页加载
- [ ] 商品详情页
  - 商品图片展示
  - 商品信息（名称、价格、描述）
  - 购买/收藏按钮
  - 相关商品推荐

**广告集成**
- [ ] 集成广告追踪SDK (ad-tracker.js)
- [ ] 首页广告位实现
  - 顶部横幅广告 (728x90)
  - 侧边栏广告 (300x250)
  - 商品列表间信息流广告
- [ ] 商品详情页广告位
  - 页面底部相关广告
  - 侧边推荐广告

**用户行为追踪**
- [ ] 商品浏览行为记录
- [ ] 搜索关键词追踪
- [ ] 商品点击统计
- [ ] 页面停留时间记录
- [ ] 广告点击和展示追踪

**技术实现细节**
- [ ] 使用Vue 3 + Element Plus构建界面
- [ ] 响应式设计，支持移动端访问
- [ ] 与广告追踪服务API对接
- [ ] 本地数据Mock（商品数据、广告数据）

**页面要求**：

- 至少展示20个商品
- 每页3-5个广告位
- 响应式设计（支持移动端）

**交付物**：

- 购物网站可正常访问
- 广告正常加载和展示
- 用户行为正常追踪

#### Day 11-13：视频网站开发（重点）（刘）

- [ ] 设计视频网站页面

  - 视频列表页
  - 视频播放页

- [ ] 

  实现视频中插广告核心功能

  - 设置广告插入时间点
  - 监听视频播放进度
  - 暂停主视频播放广告
  - 实现5秒后跳过功能
  - 广告结束自动恢复播放

- [ ] 实现视频观看行为追踪


**交付物**：

- 视频播放功能完整
- 中插广告正常工作
- 跳过按钮倒计时正确

#### Day 14：新闻网站开发（石）

- [ ] 设计新闻网站页面
  - 新闻列表页
  - 新闻详情页
- [ ] 实现顶部横幅广告
- [ ] 实现信息流原生广告
- [ ] 实现新闻阅读行为追踪
- [ ] 使用IntersectionObserver监测阅读

**交付物**：

- 新闻网站可正常访问
- 原生广告自然融入内容
- 阅读行为正常追踪

------

### 第三周：广告管理平台开发（Week 3）

#### Day 15-17：后台管理功能（杨）

- [ ] 广告商管理
  - 列表、新增、编辑、删除
- [ ] 广告素材管理
  - 上传图片/视频
  - 设置出价、目标类别
  - 广告状态管理（启用/禁用）
- [ ] 广告位配置
  - 不同网站的广告位设置
- [ ] 简单的权限管理（可选）

**页面要求**：

- 使用Element Plus快速搭建界面
- 表格、表单、分页功能
- 文件上传功能

**交付物**：

- 广告管理CRUD完成
- 文件上传功能可用
- 界面美观易用

#### Day 18-19：数据统计与分析（杨）

- [ ] 实现数据统计API
  - 广告展示量统计
  - 广告点击率(CTR)统计
  - 不同网站流量统计
  - 用户行为分布统计
- [ ] 开发数据可视化页面
  - 使用EChart绘制图表
  - 展示时间趋势
  - 展示类别分布
  - 展示转化漏斗

**交付物**：

- 数据统计接口完成
- 可视化图表展示
- 实时数据更新

#### Day 20-21：系统集成与联调

- [ ] 测试iframe方式Cookie共享（不同物理服务器模式）
- [ ] 测试跨站用户追踪
- [ ] 验证广告推荐准确性
- [ ] 性能测试与优化
- [ ] Bug修复

**测试场景**：

1. 在购物站浏览"电子产品"
2. 切换到视频站，检查是否推荐电子产品广告
3. 观看视频，验证中插广告触发
4. 切换到新闻站，验证追踪持续性
5. 清除Cookie后再次访问，验证浏览器指纹识别功能
6. 在不同设备上访问，验证跨设备追踪能力
7. 多用户并发访问，验证系统稳定性
8. 广告点击转化追踪测试
9. 高并发场景下的广告投放性能测试
10. 数据统计准确性验证

**交付物**：

- 所有功能联调通过
- 关键Bug已修复
- 性能满足要求

------

### 第四周：部署与优化（Week 4）

#### Day 22-24：云服务器部署

- [ ] 配置云服务器环境

  - 安装JDK、MySQL、Nginx
  - 配置防火墙规则

- [ ] 打包Spring Boot应用

- [ ] 上传JAR包到各个服务器

- [ ] 编写启动脚本

- [ ] 配置Nginx反向代理

- [ ] 测试所有服务可访问


**交付物**：

- 所有服务部署成功
- 支持不同物理服务器访问方式